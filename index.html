<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Hafiy Johari — Portfolio</title>

<!-- Fonts: Inter (body) + Press Start 2P (titles only) -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Press+Start+2P&display=swap" rel="stylesheet">

<style>
  :root{
    --bg:#0b0d10; --fg:#e8ecf1; --muted:#9aa7b5; --card:#11151e; --line:rgba(255,255,255,.1);
    --hi1:#7dd3fc; --hi2:#a78bfa; --glow:0 10px 30px rgba(0,0,0,.35);
  }
  /* Light theme */
  :root[data-theme="light"]{
    --bg:#f6f7fb; --fg:#0c1016; --muted:#5b6672; --card:#ffffff; --line:rgba(0,0,0,.12);
    --glow:0 10px 30px rgba(0,0,0,.1);
  }

  *{box-sizing:border-box}
  html,body{margin:0;height:100%;background:var(--bg);color:var(--fg);font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  a{color:inherit;text-decoration:none}
  .wrap{max-width:1100px;margin:0 auto;padding:28px 18px}

  /* NAV (brand | links | actions) */
  .nav{position:fixed;top:10px;left:0;right:0;z-index:40;display:flex;justify-content:center}
  .nav .shell{width:min(1100px,100%);display:flex;align-items:center;gap:12px;padding:0 12px}
  .brand{display:flex;align-items:center;gap:10px;background:rgba(10,13,18,.55);
    border:1px solid var(--line);backdrop-filter:blur(8px);border-radius:999px;padding:6px 10px;box-shadow:var(--glow)}
  :root[data-theme="light"] .brand{background:rgba(255,255,255,.65)}
  .brand img{width:26px;height:26px;object-fit:cover;border-radius:6px}
  .brand .name{font-weight:700;font-size:14px;font-family:"Press Start 2P", system-ui,sans-serif;letter-spacing:.5px}

  .bar{margin-left:auto;margin-right:auto;display:flex;gap:8px;padding:6px 10px;border-radius:999px;
    border:1px solid var(--line);backdrop-filter:blur(8px);background:rgba(10,13,18,.55);box-shadow:var(--glow)}
  :root[data-theme="light"] .bar{background:rgba(255,255,255,.65)}
  .bar a{font-size:14px;padding:8px 12px;border-radius:999px;border:1px solid transparent}
  .bar a:hover{border-color:var(--line);background:rgba(255,255,255,.06)}

  .actions{display:flex;gap:10px}
  .chip{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;border:1px solid var(--line);
    background:rgba(255,255,255,.08)}
  .chip:hover{background:rgba(255,255,255,.16)}
  .tbtn{width:34px;height:34px;display:grid;place-items:center;border-radius:999px;border:1px solid var(--line);
    background:rgba(255,255,255,.08);cursor:pointer}
  .tbtn:hover{background:rgba(255,255,255,.16)}

  /* HERO */
  .hero{position:relative;height:84vh;min-height:520px;overflow:hidden;display:grid;place-items:center}
  .hero video{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;filter:brightness(.52) contrast(1.08) saturate(1.05)}
  :root[data-theme="light"] .hero video{filter:brightness(.82) contrast(1.03) saturate(1.02)}
  .overlay{position:relative;text-align:center;padding:20px}
  .title{font-family:"Press Start 2P", system-ui,sans-serif;font-weight:400;letter-spacing:.5px;
    line-height:1.1;font-size:clamp(28px,7vw,64px);text-shadow:0 0 24px rgba(0,0,0,.35)}
  .lead{margin:12px auto 0;max-width:820px;color:var(--muted);font-size:clamp(14px,2.2vw,18px)}
  .cta{display:flex;justify-content:center;gap:10px;margin-top:22px}
  .btn{display:inline-block;padding:12px 18px;border-radius:12px;border:1px solid var(--line);background:rgba(255,255,255,.12)}
  .btn:hover{background:rgba(255,255,255,.2)}

  /* SECTION HEAD */
  h2{font-size:clamp(18px,4.6vw,28px);margin:0 0 8px;font-family:"Press Start 2P", system-ui,sans-serif;letter-spacing:.5px}
  .sub{color:var(--muted);margin:0 0 22px}
  .badge{display:inline-block;margin-left:8px;font-size:12px;padding:6px 10px;border-radius:999px;border:1px solid var(--line);background:rgba(255,255,255,.06)}

  /* SLIDESHOW */
  .slider{position:relative;overflow:hidden;border:1px solid var(--line);border-radius:16px;background:var(--card);box-shadow:var(--glow)}
  .track{display:flex;transition:transform .5s ease}
  .slide{min-width:100%;position:relative;aspect-ratio:16/9}
  .slide img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover}
  .ctrl{position:absolute;top:50%;transform:translateY(-50%);background:rgba(0,0,0,.4);
    border:1px solid var(--line);color:#fff;border-radius:999px;padding:10px 12px;cursor:pointer}
  .ctrl:hover{background:rgba(0,0,0,.6)}
  .ctrl.prev{left:10px} .ctrl.next{right:10px}
  .dots{position:absolute;left:0;right:0;bottom:10px;display:flex;gap:6px;justify-content:center}
  .dot{width:8px;height:8px;border-radius:999px;background:rgba(255,255,255,.35);border:1px solid var(--line);cursor:pointer}
  .dot.active{background:#fff}

  /* GRID */
  .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px}
  .card{grid-column:span 12;background:var(--card);border:1px solid var(--line);border-radius:16px;overflow:hidden;box-shadow:var(--glow);transform:translateZ(0)}
  @media(min-width:720px){.card{grid-column:span 6}}
  @media(min-width:1060px){.card{grid-column:span 4}}
  .thumb{position:relative;aspect-ratio:16/10;overflow:hidden}
  .thumb img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;transition:transform .7s ease,filter .7s ease}
  .pillwrap{position:absolute;left:12px;bottom:12px;display:flex;gap:6px;flex-wrap:wrap}
  .pill{font-size:12px;padding:6px 10px;border-radius:999px;background:rgba(15,18,28,.7);border:1px solid var(--line)}
  .body{padding:12px 14px}
  .body h3{margin:2px 0 6px;font-size:16px}
  .meta{display:flex;gap:8px;align-items:center;color:var(--muted);font-size:12px}
  .card{transition:transform .18s ease, box-shadow .18s ease}
  .card:hover .thumb img{transform:scale(1.07) rotate(.4deg);filter:contrast(1.05) saturate(1.05)}
  .card:hover{transform:translateY(-2px);box-shadow:0 18px 40px rgba(0,0,0,.32)}

  /* LIGHTBOX */
  .lb{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.8);z-index:70}
  .lb.show{display:flex}
  .lb img{max-width:92vw;max-height:92vh;border-radius:8px;box-shadow:0 20px 60px rgba(0,0,0,.6)}
  .lb .x{position:absolute;top:14px;right:14px;background:rgba(255,255,255,.1);border:1px solid var(--line);
    color:#fff;border-radius:10px;padding:8px 10px;cursor:pointer;z-index:3}
  .lb .x:hover{background:rgba(255,255,255,.2)}
  .lb .nav{position:absolute;inset:0;display:flex;align-items:center;justify-content:space-between;padding:0 12px;pointer-events:none}
  .lb .nav button{pointer-events:auto;background:transparent;border:none;color:#fff;font-size:28px;cursor:pointer;opacity:.9}
  .lb .nav button:hover{opacity:1}

  /* CONTACT ICONS */
  .iconbar{display:flex;flex-wrap:wrap;gap:10px;margin-top:8px}
  .iconbtn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;border:1px solid var(--line);background:rgba(255,255,255,.08)}
  .iconbtn:hover{background:rgba(255,255,255,.16)}
  .iconbtn svg{width:18px;height:18px;display:block}

  /* REVEAL */
  .reveal{opacity:0;transform:translateY(10px);transition:opacity .6s ease, transform .6s ease}
  .reveal.show{opacity:1;transform:none}

  footer{padding:38px 18px;color:var(--muted);text-align:center;border-top:1px solid var(--line);margin-top:40px}
</style>
</head>

<body>
  <!-- NAV -->
  <nav class="nav">
    <div class="shell">
      <a href="#" class="brand" aria-label="Home">
        <img src="assets/Hafiy Johari Concept Logo Compilation-01.png" alt="Hafiy logo">
        <span class="name">Hafiy Johari</span>
      </a>

      <div class="bar">
        <a href="#work">Work</a>
        <a href="#about">About</a>
        <a href="#contact">Contact</a>
        <a href="https://www.behance.net/hafiyjohari" target="_blank" rel="noreferrer">Behance ↗</a>
      </div>

      <div class="actions">
        <a class="chip" href="#contact">Let’s talk</a>
        <button id="themeToggle" class="tbtn" aria-label="Toggle theme">☾</button>
      </div>
    </div>
  </nav>

  <!-- HERO -->
  <header class="hero">
    <video autoplay muted loop playsinline poster="assets/hero.jpg">
      <source src="assets/hero.webm" type="video/webm" />
      <source src="assets/hero.mp4" type="video/mp4" />
    </video>
    <div class="overlay">
      <div class="title">Hafiy Johari</div>
      <p class="lead">Graphic Designer & Creative Explorer. I build brand systems and tasty F&amp;B visuals that scale across platforms. Hover the wall below for a peek; click for details.</p>
      <div class="cta">
        <a class="btn" href="#work">See my work ↓</a>
        <a class="btn" href="#contact">Hire / collab →</a>
      </div>
    </div>
  </header>

  <main class="wrap">
    <!-- Featured Slideshow -->
    <section class="reveal" style="margin-bottom:24px">
      <h2>Featured <span class="badge">slideshow</span></h2>
      <p class="sub">Tap the image to view full size; arrows to browse.</p>

      <div class="slider" id="slider">
        <div class="track" id="track"></div>
        <button class="ctrl prev" id="prev" aria-label="Previous">‹</button>
        <button class="ctrl next" id="next" aria-label="Next">›</button>
        <div class="dots" id="dots"></div>
      </div>
    </section>

    <!-- Work grid -->
    <section id="work" class="reveal">
      <h2>Selected Work <span class="badge" id="count">0</span></h2>
      <p class="sub">A living wall — easy to add more later inside <code>projects</code> below.</p>
      <div id="grid" class="grid"></div>
    </section>

    <!-- Mini-game -->
    <section id="game" class="reveal" style="margin-top:48px">
      <h2>Playful Mode <span class="badge">mini-game</span></h2>
      <p class="sub">Pop as many cubes as you can in 30 seconds. Click or tap them.</p>

      <div style="position:relative;border:1px solid var(--line);border-radius:16px;background:var(--card);overflow:hidden">
        <canvas id="cubeGame" style="display:block;width:100%;height:360px"></canvas>

        <!-- HUD -->
        <div style="position:absolute;left:12px;top:12px;display:flex;gap:10px">
          <span class="badge" id="gScore">Score: 0</span>
          <span class="badge" id="gTime">30s</span>
        </div>
        <button id="gStart" class="btn" style="position:absolute;right:12px;top:12px">Start</button>
      </div>
    </section>

    <!-- About -->
    <section id="about" class="reveal" style="margin-top:46px">
      <h2>About</h2>
      <p class="sub" style="max-width:820px">
        A graphic designer from Kedah, Malaysia, now based in Selangor. I started in 2012 and my work sits at the intersection of
        visual art, illustration, and graphic design. I move comfortably across styles and applications, and enjoy building
        systems you can actually ship.
      </p>
    </section>

    <!-- Contact -->
    <section id="contact" class="reveal" style="margin-top:32px">
      <h2>Contact</h2>
      <p class="sub">Open to commissions &amp; collaborations.</p>

      <div class="iconbar">
        <!-- Email -->
        <a class="iconbtn" href="mailto:hafiyjohari@gmail.com">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
            <path d="M3 7.5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-9Z"/>
            <path d="m4 7 8 6 8-6"/>
          </svg>
          hafiyjohari@gmail.com
        </a>

        <!-- LinkedIn -->
        <a class="iconbtn" target="_blank" rel="noreferrer" href="https://www.linkedin.com/in/hafiyjohari">
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M4.98 3.5C4.98 4.88 3.86 6 2.5 6S0 4.88 0 3.5 1.12 1 2.5 1s2.48 1.12 2.48 2.5zM0 8h5v16H0V8zm7.5 0h4.8v2.2h.07c.67-1.27 2.3-2.6 4.73-2.6 5.06 0 6 3.33 6 7.66V24h-5v-7.33c0-1.75-.03-4-2.44-4-2.44 0-2.82 1.9-2.82 3.86V24h-5V8z"/>
          </svg>
          LinkedIn
        </a>

        <!-- Instagram -->
        <a class="iconbtn" target="_blank" rel="noreferrer" href="https://www.instagram.com/yourusername">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
            <rect x="3" y="3" width="18" height="18" rx="4"/>
            <circle cx="12" cy="12" r="4"/>
            <circle cx="17.5" cy="6.5" r="1.2" fill="currentColor" stroke="none"/>
          </svg>
          Instagram
        </a>

        <!-- Behance -->
        <a class="iconbtn" target="_blank" rel="noreferrer" href="https://www.behance.net/hafiyjohari">
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M8.2 11.2c.9-.3 1.5-1 1.5-2.1 0-1.9-1.4-2.8-3.4-2.8H1v10.6h5.5c2.2 0 3.6-1.2 3.6-3.2 0-1.5-.8-2.3-1.9-2.5Zm-4-3.1h2.7c.9 0 1.4.4 1.4 1.2s-.5 1.2-1.4 1.2H4.2v-2.4Zm2.8 7.2H4.2v-2.8h2.9c1 0 1.6.5 1.6 1.4s-.6 1.4-1.7 1.4ZM23 14.3c0-2.4-1.6-4.1-4-4.1-2.6 0-4.2 1.8-4.2 4.4 0 2.7 1.7 4.3 4.4 4.3 2 0 3.4-.9 3.9-2.7h-2.2c-.3.6-.8 1-1.7 1-1.1 0-1.8-.6-2-1.8H24c.1-.4.1-.7.1-1.1Zm-5.9-1.3c.2-1.1.9-1.7 1.9-1.7 1 0 1.7.7 1.8 1.7h-3.7ZM15.4 7.2H20V6h-4.6v1.2Z"/>
          </svg>
          Behance
        </a>
      </div>

      <p class="sub" style="margin-top:14px">Downloads: <a href="resume.pdf">Resume (PDF)</a></p>
    </section>
  </main>

  <footer>© <script>document.write(new Date().getFullYear())</script> Hafiy Johari. All rights reserved.</footer>

  <!-- Lightbox -->
  <div class="lb" id="lightbox" aria-hidden="true">
    <button class="x" id="lbClose">Close ✕</button>
    <div class="nav" aria-hidden="true">
      <button id="lbPrev" aria-label="Previous">‹</button>
      <button id="lbNext" aria-label="Next">›</button>
    </div>
    <img id="lbImg" alt="" />
  </div>

  <!-- ===== DATA + LOGIC ===== -->
  <script>
    /* ---------- Theme toggle ---------- */
    const root = document.documentElement;
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme) root.setAttribute('data-theme', savedTheme);
    const themeBtn = document.getElementById('themeToggle');
    function updateThemeIcon(){
      const light = root.getAttribute('data-theme') === 'light';
      themeBtn.textContent = light ? '☀︎' : '☾';
    }
    updateThemeIcon();
    themeBtn.addEventListener('click', ()=>{
      const isLight = root.getAttribute('data-theme') === 'light';
      root.setAttribute('data-theme', isLight ? 'dark' : 'light');
      localStorage.setItem('theme', isLight ? 'dark' : 'light');
      updateThemeIcon();
    });

    /* ---------- 1) EDITABLE DATA ---------- */
    const slides = [
      '20240807_Random Comp_v1-01.jpg',
      'Hafiy Johari 0.5081994_Pattern-01.png',
      'Hafiy Johari Concept Logo Compilation-01.png',
      'Logo Budak Butter_v2-01.jpg'
    ].map(n => `assets/${n}`);

    const projects = [
      { title:'Budak Butter — Logo & Mascot', subtitle:'Brand grid, clear space, packaging visuals', image:'Logo Budak Butter_v2-01.jpg', tags:['Branding','Logo','Illustration'], link:'#', year:2024 },
      { title:'IHFHEX 2020 — Campaign Kit', subtitle:'Posts & stories for F&B brands under IHFHEX', image:'Hafiy Johari Concept Logo Compilation-01.png', tags:['Event','Key Visual','Social'], link:'#', year:2020 },
      { title:'Shell Singapore — Handbook', subtitle:'Friendly editorial layout system', image:'20240807_Random Comp_v1-01.jpg', tags:['Layout','Publication'], link:'#', year:2018 }
    ];

    /* ---------- 2) BUILD SLIDESHOW ---------- */
    const track = document.getElementById('track');
    const dots  = document.getElementById('dots');
    let idx = 0, timer;

    slides.forEach((src, i) => {
      const s = document.createElement('div');
      s.className = 'slide';
      s.innerHTML = `<img src="${src}" alt="Featured ${i+1}" data-lightbox="${src}">`;
      track.appendChild(s);

      const d = document.createElement('button');
      d.className = 'dot' + (i===0?' active':'');
      d.addEventListener('click', ()=>go(i));
      dots.appendChild(d);
    });

    function go(i){
      idx = (i + slides.length) % slides.length;
      track.style.transform = `translateX(${-idx*100}%)`;
      [...dots.children].forEach((el,j)=> el.classList.toggle('active', j===idx));
    }
    function next(){ go(idx+1); }
    function prev(){ go(idx-1); }
    document.getElementById('next').onclick = next;
    document.getElementById('prev').onclick = prev;
    function start(){ timer = setInterval(next, 4000); }
    function stop(){ clearInterval(timer); }
    document.getElementById('slider').addEventListener('mouseenter', stop);
    document.getElementById('slider').addEventListener('mouseleave', start);
    start();

    /* ---------- 3) BUILD GRID ---------- */
    const grid = document.getElementById('grid');
    const count = document.getElementById('count');

    function cardTemplate(p){
      const src = `assets/${p.image}`;
      const t = document.createElement('article');
      t.className='card';
      t.innerHTML = `
        <a href="${p.link || '#'}" ${p.link && p.link.startsWith('http')?'target="_blank" rel="noreferrer"':''}>
          <div class="thumb">
            <img src="${src}" alt="${p.title}" data-lightbox="${src}">
            <div class="pillwrap">${(p.tags||[]).map(tag=>`<span class='pill'>${tag}</span>`).join('')}</div>
          </div>
          <div class="body">
            <div class="meta"><span>${p.year||''}</span></div>
            <h3>${p.title}</h3>
            <div class="sub">${p.subtitle||''}</div>
          </div>
        </a>`;
      t.addEventListener('mousemove', (e)=>{
        const r = t.getBoundingClientRect();
        const x = (e.clientX - r.left) / r.width - .5;
        const y = (e.clientY - r.top) / r.height - .5;
        t.style.transform = `rotateX(${-y*2}deg) rotateY(${x*2}deg) translateY(-2px)`;
      });
      t.addEventListener('mouseleave', ()=>{ t.style.transform='translateY(0)'; });
      return t;
    }
    projects.forEach(p=> grid.appendChild(cardTemplate(p)));
    count.textContent = projects.length;

    /* ---------- 4) LIGHTBOX (fixed close) ---------- */
    const lb = document.getElementById('lightbox');
    const lbImg = document.getElementById('lbImg');
    const lbClose = document.getElementById('lbClose');
    const lbPrev = document.getElementById('lbPrev');
    const lbNext = document.getElementById('lbNext');

    let lbList = slides.slice();
    let lbIndex = 0;

    function openLB(src, list){
      lbList = list || slides;
      lbIndex = lbList.indexOf(src);
      if (lbIndex < 0) lbIndex = 0;
      lbImg.src = lbList[lbIndex];
      lb.classList.add('show');
      lb.setAttribute('aria-hidden','false');
    }
    function closeLB(){
      lb.classList.remove('show');
      lb.setAttribute('aria-hidden','true');
    }
    function lbGo(delta){
      lbIndex = (lbIndex + delta + lbList.length) % lbList.length;
      lbImg.src = lbList[lbIndex];
    }
    lbClose.addEventListener('click', (e)=>{ e.stopPropagation(); closeLB(); });
    lb.addEventListener('click', (e)=>{ if(e.target === lb) closeLB(); });
    lbPrev.onclick = ()=>lbGo(-1);
    lbNext.onclick = ()=>lbGo(1);
    document.addEventListener('keydown', e=>{
      if(!lb.classList.contains('show')) return;
      if(e.key==='Escape') closeLB();
      if(e.key==='ArrowRight') lbGo(1);
      if(e.key==='ArrowLeft')  lbGo(-1);
    });

    // Delegate clicks for any element with data-lightbox
    document.addEventListener('click', e=>{
      const el = e.target.closest('[data-lightbox]');
      if(!el) return;
      e.preventDefault();
      const src = el.getAttribute('data-lightbox');
      // Build list of current grid images for left/right
      const gridImgs = [...document.querySelectorAll('#grid .thumb img')].map(i=>i.src);
      const list = el.closest('#grid') ? gridImgs : slides;
      openLB(src, list);
    });

    /* ---------- 5) SCROLL REVEAL ---------- */
    const ro = new IntersectionObserver(entries=>{
      entries.forEach(el=>{
        if(el.isIntersecting){ el.target.classList.add('show'); ro.unobserve(el.target); }
      });
    }, {threshold:.08});
    document.querySelectorAll('.reveal').forEach(n=>ro.observe(n));

/* -------- 6) MINI-GAME (ramped pace) ---------- */
(()=> {
  const cvs      = document.getElementById('cubeGame');
  if (!cvs) return;

  const startBtn = document.getElementById('gStart');
  const scoreEl  = document.getElementById('gScore');
  const timeEl   = document.getElementById('gTime');
  const ctx      = cvs.getContext('2d');

  let W=0, H=0, cubes=[], running=false, score=0, tLeft=30, last=0;
  let spawnClock = 0;

  // ---- Pace knobs (adjust these) ----
  const BASE_SPAWN = 0.55;   // was 0.9  -> spawns a bit more often
  const MAX_CUBES  = 12;     // was 9    -> allow a couple more on screen
  const SPEED_RAMP = 0.9;    // 0..1 how much speed rises over the 30s round

  function resize(){
    const r = cvs.getBoundingClientRect();
    cvs.width  = r.width  * devicePixelRatio;
    cvs.height = r.height * devicePixelRatio;
    ctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);
    W = r.width; H = r.height;
  }
  new ResizeObserver(resize).observe(cvs);

  function spawn(){
    const s  = 28 + Math.random()*18;          // 28–46 px (friendly size)
    const vx = (Math.random()-.5) * 40;         // gentle horizontal drift
    const vy = - (60 + Math.random()*50);       // -60..-110 px/s upward
    cubes.push({ x: Math.random()*W, y: H + s, vx, vy, size: s, life: 1 });
  }

  function tick(dt){
    // ramp grows from 1.0 -> 1.0+SPEED_RAMP across the round
    const ramp = 1 + (30 - tLeft)/30 * SPEED_RAMP;

    // spawn cadence speeds up a bit over time
    spawnClock += dt * ramp;
    if (spawnClock >= BASE_SPAWN / ramp && cubes.length < MAX_CUBES){
      spawn();
      spawnClock = 0;
    }

    // movement (also scales with ramp)
    cubes.forEach(c=>{
      c.x += c.vx * dt * ramp * 0.9;
      c.y += c.vy * dt * ramp;
      c.x += Math.sin((c.y + c.size) * 0.02) * (8 * dt * ramp * 0.9); // tiny wiggle
      if (c.y < -40) c.life = 0;
    });
    cubes = cubes.filter(c=>c.life>0);
  }

  function draw(){
    ctx.clearRect(0,0,W,H);
    cubes.forEach(c=>{
      const g = ctx.createLinearGradient(c.x, c.y, c.x+c.size, c.y+c.size);
      g.addColorStop(0, '#7dd3fc'); g.addColorStop(1, '#a78bfa');
      ctx.fillStyle = g;
      ctx.strokeStyle = 'rgba(255,255,255,.25)';
      ctx.lineWidth = 2;

      ctx.save(); ctx.translate(c.x, c.y); ctx.rotate(0.18); ctx.globalAlpha = 0.95;
      ctx.fillRect(-c.size/2, -c.size/2, c.size, c.size);
      ctx.strokeRect(-c.size/2, -c.size/2, c.size, c.size);
      ctx.restore();

      // soft glow
      ctx.save(); ctx.globalAlpha = 0.12; ctx.fillStyle = '#7dd3fc';
      ctx.beginPath(); ctx.arc(c.x, c.y+7, c.size*0.75, 0, Math.PI*2); ctx.fill();
      ctx.restore();
    });
  }

  function loop(ts){
    if (!running) return;
    const dt = Math.min(0.05, (ts - (last||ts))/1000); // clamp
    last = ts;
    tick(dt);
    draw();
    requestAnimationFrame(loop);
  }

  function start(){
    running = true; score = 0; tLeft = 30; cubes = []; last = 0; spawnClock = 0;
    scoreEl.textContent = 'Score: 0';
    timeEl.textContent  = '30s';
    startBtn.disabled = true;

    const timer = setInterval(()=>{
      tLeft--; timeEl.textContent = tLeft+'s';
      if (tLeft<=0){ clearInterval(timer); end(); }
    }, 1000);

    requestAnimationFrame(loop);
  }

  function end(){
    running = false;
    startBtn.disabled = false;
    alert('Nice! Final score: ' + score);
  }

  function getPos(evt){
    const r = cvs.getBoundingClientRect();
    const x = (evt.touches?evt.touches[0].clientX:evt.clientX) - r.left;
    const y = (evt.touches?evt.touches[0].clientY:evt.clientY) - r.top;
    return {x,y};
  }

  function hitTest(x,y){
    // friendly hitbox ~90% of square
    for (let i=cubes.length-1;i>=0;i--){
      const c = cubes[i];
      if (Math.abs(x - c.x) <= c.size*0.9 && Math.abs(y - c.y) <= c.size*0.9){
        cubes.splice(i,1);
        score++; scoreEl.textContent = 'Score: ' + score;
        return true;
      }
    }
    return false;
  }

  cvs.addEventListener('click', e=>{ if(running){ const {x,y}=getPos(e); hitTest(x,y); }});
  cvs.addEventListener('touchstart', e=>{ if(running){ const {x,y}=getPos(e); hitTest(x,y); }}, {passive:true});
  startBtn.addEventListener('click', start);
})();
</script>

</body>
</html>
